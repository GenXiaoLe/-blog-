<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>服务端部署 | 梁亚根的技术分享</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="前端知识记录分享">
    
    <link rel="preload" href="/assets/css/0.styles.afc64ad8.css" as="style"><link rel="preload" href="/assets/js/app.2e55a6a0.js" as="script"><link rel="preload" href="/assets/js/2.3a20e52e.js" as="script"><link rel="preload" href="/assets/js/12.01bba0de.js" as="script"><link rel="prefetch" href="/assets/js/10.96980c36.js"><link rel="prefetch" href="/assets/js/11.ef7bbd41.js"><link rel="prefetch" href="/assets/js/3.f81a9445.js"><link rel="prefetch" href="/assets/js/4.95de2f6c.js"><link rel="prefetch" href="/assets/js/5.ab5d39e7.js"><link rel="prefetch" href="/assets/js/6.11849f16.js"><link rel="prefetch" href="/assets/js/7.2a4e4b54.js"><link rel="prefetch" href="/assets/js/8.26d4bcc7.js"><link rel="prefetch" href="/assets/js/9.2681ea36.js">
    <link rel="stylesheet" href="/assets/css/0.styles.afc64ad8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">梁亚根的技术分享</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="https://segmentfault.com/u/yagenl" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Segmentfault主页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/GenXiaoLe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="https://segmentfault.com/u/yagenl" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Segmentfault主页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/GenXiaoLe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/nodeBasis/" class="sidebar-link">node基础</a></li><li><a href="/vue2Basis/" class="sidebar-link">vue2基础</a></li><li><a href="/project/" class="sidebar-link">项目应用</a></li><li><a href="/webProject/" aria-current="page" class="active sidebar-link">服务端部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webProject/#服务端部署" class="sidebar-link">服务端部署</a></li><li class="sidebar-sub-header"><a href="/webProject/#pm2启动node服务" class="sidebar-link">Pm2启动node服务</a></li><li class="sidebar-sub-header"><a href="/webProject/#docker使用" class="sidebar-link">Docker使用</a></li><li class="sidebar-sub-header"><a href="/webProject/#jenkins使用" class="sidebar-link">Jenkins使用</a></li></ul></li><li><a href="/article/" class="sidebar-link">个人拓展文章</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="服务端部署"><a href="#服务端部署" class="header-anchor">#</a> 服务端部署</h2> <h2 id="pm2启动node服务"><a href="#pm2启动node服务" class="header-anchor">#</a> Pm2启动node服务</h2> <h2 id="docker使用"><a href="#docker使用" class="header-anchor">#</a> Docker使用</h2> <p>Docker是一款以容器虚拟化技术为基础的软件。为程序跨平台兼容而生，将虚拟化应用于资源管理，是一个由 Go 语言实现的容器引擎。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Docker是围绕镜像 ( Image )、容器 ( Container )、网络 ( Network )、数据卷 ( Volume )所展开。我们所有的操作均以CentOS操作系统为例</p></div> <h3 id="安装docker"><a href="#安装docker" class="header-anchor">#</a> 安装docker</h3> <p>首先进行 Docker 的安装</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo yum install yum-utils device-mapper-persistent-data lvm2
$
$ sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
$ sudo yum install docker-ce
$
$ sudo systemctl enable docker
$ sudo systemctl start docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="上手使用"><a href="#上手使用" class="header-anchor">#</a> 上手使用</h3> <p>在安装 Docker 完成之后，我们需要先启动 docker daemon 使其能够为我们提供 Docker 服务，这样我们才能正常使用 Docker。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo systemctl start docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><strong>docker version</strong></li></ul> <p>在 Docker 服务启动之后，我们先来尝试一个最简单的查看 Docker 版本的命令：<strong>docker version</strong>。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo docker version
Client:
 Version:           18.06.1-ce
 API version:       1.38
 Go version:        go1.10.3
 Git commit:        e68fc7a
 Built:             Tue Aug 21 17:23:03 2018
 OS/Arch:           linux/amd64
 Experimental:      false

Server:
 Engine:
  Version:          18.06.1-ce
  API version:      1.38 (minimum version 1.12)
  Go version:       go1.10.3
  Git commit:       e68fc7a
  Built:            Tue Aug 21 17:25:29 2018
  OS/Arch:          linux/amd64
  Experimental:     false
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li><strong>docker info</strong></li></ul> <p>如果想要了解 Docker Engine 更多相关的信息，我们还可以通过 <strong>docker info</strong> 这个命令。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo docker info
Containers: 0
 Running: 0
 Paused: 0
 Stopped: 0
Images: 0
Server Version: 18.06.0-ce
Storage Driver: overlay2
 Backing Filesystem: extfs
 Supports d_type: true
 Native Overlay Diff: true
Logging Driver: json-file
Cgroup Driver: cgroupfs
## ......
Live Restore Enabled: false
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li><strong>配置国内镜像源</strong></li></ul> <p>在 Linux 环境下，我们可以通过修改 /etc/docker/daemon.json ( 如果文件不存在，你可以直接创建它 ) 这个 Docker 服务的配置文件达到效果。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>注意镜像是以https://开头</p></div> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
    &quot;registry-mirrors&quot;: [
        &quot;https://registry.docker-cn.com&quot;
    ]
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在修改之后，别忘了重新启动 docker daemon 来让配置生效哟：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo systemctl restart docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>要验证我们配置的镜像源是否生效，我们可以通过 <strong>docker info</strong> 来查阅当前注册的镜像源列表。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo docker info
## ......
Registry Mirrors:
 https://registry.docker-cn.com/
## ......
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><strong>查看镜像</strong></li></ul> <p>如果要查看当前连接的 docker daemon 中存放和管理了哪些镜像，我们可以使用 <strong>docker images</strong> 这个命令 ( Linux、macOS 还是 Windows 上都是一致的 )。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
php                 7-fpm               f214b5c48a25        9 days ago          368MB
redis               3.2                 2fef532eadb3        11 days ago         76MB
redis               4.0                 e1a73233e3be        11 days ago         83.4MB
cogset/cron         latest              c01d5ac6fc8a        15 months ago       125MB
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><strong>获取镜像</strong></li></ul> <p>要拉取镜像，我们可以使用 <strong>docker pull</strong> 命令，命令的参数就是我们之前所提到的镜像仓库名。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo docker pull ubuntu
Using default tag: latest
latest: Pulling from library/ubuntu
124c757242f8: Downloading [===============================================&gt;   ]  30.19MB/31.76MB
9d866f8bde2a: Download complete 
fa3f2f277e67: Download complete 
398d32b153e8: Download complete 
afde35469481: Download complete 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>当然，我们也能够使用完整的镜像命名来拉取镜像。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo docker pull openresty/openresty:1.13.6.2-alpine
1.13.6.2-alpine: Pulling from openresty/openresty
ff3a5c916c92: Pull complete 
ede0a2a1012b: Pull complete 
0e0a11843023: Pull complete 
246b2c6f4992: Pull complete 
Digest: sha256:23ff32a1e7d5a10824ab44b24a0daf86c2df1426defe8b162d8376079a548bf2
Status: Downloaded newer image for openresty/openresty:1.13.6.2-alpine
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Docker Hub 是 Docker 官方建立的中央镜像仓库，除了普通镜像仓库的功能外，它内部还有更加细致的权限管理，支持构建钩子和自动构建，并且有一套精致的 Web 操作页面。
Docker Hub 的地址是：hub.docker.com/。</p></div> <ul><li><strong>管理镜像</strong></li></ul> <p>如果我们要获得镜像更详细的信息，我们可以通过 <strong>docker inspect</strong> 这个命令。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo docker inspect redis:3.2
[
    {
        &quot;Id&quot;: &quot;sha256:2fef532eadb328740479f93b4a1b7595d412b9105ca8face42d3245485c39ddc&quot;,
        &quot;RepoTags&quot;: [
            &quot;redis:3.2&quot;
        ],
        &quot;RepoDigests&quot;: [
            &quot;redis@sha256:745bdd82bad441a666ee4c23adb7a4c8fac4b564a1c7ac4454aa81e91057d977&quot;
        ],
## ......
    }
]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li><strong>删除镜像</strong></li></ul> <p>删除镜像的命令是 <strong>docker rmi</strong>，参数是镜像的名称或 ID。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ sudo docker rmi redis:3.2 redis:4.0
Untagged: redis:3.2
Untagged: redis@sha256:745bdd82bad441a666ee4c23adb7a4c8fac4b564a1c7ac4454aa81e91057d977
Deleted: sha256:2fef532eadb328740479f93b4a1b7595d412b9105ca8face42d3245485c39ddc
## ......
Untagged: redis:4.0
Untagged: redis@sha256:b77926b30ca2f126431e4c2055efcf2891ebd4b4c4a86a53cf85ec3d4c98a4c9
Deleted: sha256:e1a73233e3beffea70442fc2cfae2c2bab0f657c3eebb3bdec1e84b6cc778b75
## ......
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="jenkins使用"><a href="#jenkins使用" class="header-anchor">#</a> Jenkins使用</h2> <ol><li>安装docker</li> <li>服务器安装java8</li> <li>安装镜像jenkins(不要使用官方jenkins 版本太低、使用jenkins/jenkins)</li> <li>启动容器 8080端口指向8000，容器命名为reina-jenkins，使用镜像jenkins/jenkins：docker run --name reina-jenkins -p 8000:8080 -p 50000:50000 jenkins/jenkins</li> <li>打开8000端口，复制logs中的用户密码 登录，选择推荐插件进行安装</li> <li>创建用户</li> <li>系统设置-&gt;插件管理-&gt;高级设置、替换站点https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json并保存</li> <li>可选插件，搜索github和git进行安装</li> <li>在github进行设置，得到token：b301e05beb0ca90fbec24523a3cdb66dbdd4ecbb</li> <li>jenkins创建任务</li> <li>再次启动 docker start [id/name]</li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/7/2020, 2:42:50 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/project/" class="prev">
        项目应用
      </a></span> <span class="next"><a href="/article/">
        个人拓展文章
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2e55a6a0.js" defer></script><script src="/assets/js/2.3a20e52e.js" defer></script><script src="/assets/js/12.01bba0de.js" defer></script>
  </body>
</html>
